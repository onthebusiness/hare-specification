\specsection{Declarations}

% TODO: split grammars across pagebreaks
\newpage
\begin{grammar}
\nonterminaldef{declarations} \\
	\optional{\terminal{export}} \nonterminal{declaration} \terminal{;} \\
	\optional{\terminal{export}} \nonterminal{declaration} \terminal{;} \nonterminal{declarations} \\

\nonterminaldef{declaration} \\
	\nonterminal{global-declaration} \\
	\nonterminal{constant-declaration} \\
	\nonterminal{type-declaration} \\
	\nonterminal{function-declaration} \\
\end{grammar}

A \nonterminal{declaration} specifies the interpretation and attributes of a set
of \nonterminal{identifier}s.

\specsubitem
The \nonterminal{identifier}s shall be visible anywhere within the current
translation unit. If the \terminal{export} keyword is used, the
\nonterminal{identifier}s shall be part of the unit's exported interface.

\specsubsection{Global declarations}

\begin{grammar}
\nonterminaldef{global-declaration} \\
	\terminal{let} \nonterminal{global-bindings} \\
	\terminal{const} \nonterminal{global-bindings} \\

\nonterminaldef{global-bindings} \\
	\nonterminal{global-binding} \optional{\terminal{,}} \\
	\nonterminal{global-bindings} \terminal{,} \nonterminal{global-binding} \\

\nonterminaldef{global-binding} \\
	\optional{\nonterminal{decl-attr}} \nonterminal{identifier} \terminal{:} \nonterminal{type} \terminal{=} \nonterminal{simple-expression} \\

\nonterminaldef{decl-attr} \\
	\terminal{@symbol} \terminal{(} \nonterminal{string-constant} \terminal{)}
\end{grammar}

\specsubsubitem
In a \nonterminal{global-declaration}, sufficient space shall be reserved for
each \nonterminal{identifier} in the \nonterminal{global-bindings} to store
the \nonterminal{type} associated with it. That storage shall be initialized to
the value of the \nonterminal{simple-expression} and shall have alignment
greater than or equal to the necessary alignment for the \nonterminal{type}. In
the \terminal{const} form, the \nonterminal{type}s shall have the constant flag
enabled by default.

\specsubsubitem
A \nonterminal{global-binding}'s \nonterminal{simple-expression} shall be
limited to the \secref{Translation compatible expression subset}, and shall be
evaluated in the translation environment. The type of the value of the
\nonterminal{simple-expression} shall assignable to \nonterminal{type}.

\specsubsubitem
The interpretation of the \terminal{@symbol} form of \nonterminal{decl-attr} is
implementation-defined.

\specsubsection{Constant declarations}

\begin{grammar}
\nonterminaldef{constant-declaration} \\
	\terminal{def} \nonterminal{constant-bindings} \\

\nonterminaldef{constant-bindings} \\
	\nonterminal{constant-binding} \optional{\terminal{,}} \\
	\nonterminal{constant-bindings} \terminal{,} \nonterminal{constant-binding} \\

\nonterminaldef{constant-binding} \\
	\nonterminal{identifier} \terminal{:} \nonterminal{type} \terminal{=} \nonterminal{simple-expression} \\
\end{grammar}

\specsubsubitem
In a \nonterminal{constant-declaration}, the \nonterminal{identifier}s in the
\nonterminal{constant-binding} shall be available to the translation
environment. No storage shall be allocated for them in the execution
environment, and they shall not be addressable. References to them shall be
equivalent to references to the \nonterminal{simple-expression} associated with
them, with a cast to \nonterminal{type} inserted.

\specsubsubitem
A \nonterminal{constant-binding}'s \nonterminal{simple-expression} shall be
limited to the \secref{Translation compatible expression subset}, and shall be
evaluated in the translation environment. The type of the value of the
\nonterminal{simple-expression} shall assignable to \nonterminal{type}.

\specsubsection{Type declarations}

\begin{grammar}
\nonterminaldef{type-declaration} \\
	\terminal{type} \nonterminal{type-bindings} \\

\nonterminaldef{type-bindings} \\
	\nonterminal{identifier} \terminal{=} \nonterminal{type} \optional{\terminal{,}} \\
	\nonterminal{identifier} \terminal{=} \nonterminal{type} \terminal{,} \nonterminal{type-bindings} \\
\end{grammar}

\specsubsubitem
In a \nonterminal{type-declaration}, the \nonterminal{identifier}s shall declare
type aliases. In a \nonterminal{type-binding}, the underlying type for the
\nonterminal{identifier} shall be the \nonterminal{type}.

\specsubsection{Function declarations}

\begin{grammar}
\nonterminaldef{function-declaration} \\
	\optional{\nonterminal{fndec-attrs}} \terminal{fn}
		\nonterminal{identifier} \nonterminal{prototype} \terminal{=}
		\nonterminal{complex-expression} \\

\nonterminaldef{fndec-attrs} \\
	\nonterminal{fndec-attr} \\
	\nonterminal{fndec-attr} \nonterminal{fndec-attrs} \\

\nonterminaldef{fndec-attr} \\
	\terminal{@fini} \\
	\terminal{@init} \\
	\terminal{@test} \\
	\nonterminal{fntype-attr} \\
	\nonterminal{decl-attr} \\
\end{grammar}

% TODO: @test
% TODO: Prototypes

\specsubsubitem
The \terminal{@fini} form of \nonterminal{fndec-attr} shall cause the
function to be a finalization function. \terminal{@init} shall cause it to be an
initialization function. If multiple \nonterminal{fndec-attr}s of the same type
are specified, the last one shall override all previous ones.

References: \secref{Initialization functions}, \secref{Finalization functions}

\specsubsubitem
The result type of the expression shall be assignable to the prototype's result
type.

\specsubsubitem
If \terminal{@noreturn} is not specified by the prototype and the expression
type is \nonterminal{expression-list}, the function's expression shall
terminate. If \terminal{@noreturn} is specified, the expression shall not
terminate.

\specsubsubitem
If \terminal{@init}, \terminal{@fini}, \terminal{@test}, or
\terminal{@noreturn} are given, the result type shall be \terminal{void}.

\specsection{Units}

\begin{grammar}
\nonterminaldef{sub-unit}\\
	\optional{\nonterminal{imports}} \nonterminal{declarations}\\

\nonterminaldef{imports}\\
	\nonterminal{use-statement}\\
	\nonterminal{use-statement} \nonterminal{imports}\\

\nonterminaldef{use-statement}\\
	\terminal{use} \nonterminal{identifier} \terminal{;}\\
	\terminal{use} \nonterminal{name} \terminal{=} \nonterminal{identifier} \terminal{;}\\
	\terminal{use} \nonterminal{identifier} \terminal{::} \terminal{\{} \nonterminal{name-list} \terminal{\}} \terminal{;}\\

\nonterminaldef{name-list}\\
	\nonterminal{name} \optional{\terminal{,}}\\
	\nonterminal{name} \terminal{,} \nonterminal{name-list}\\
\end{grammar}

\specsubitem
A unit, or translation unit, is composed of several source files as described
by \secref{Translation steps}. Each source file is a \nonterminal{sub-unit}.

\specsubitem
An \nonterminal{import} shall declare a dependency between this translation
unit and another module of the namespace specified by the
\nonterminal{use-statement} \nonterminal{identifier}. This shall cause the named
module to be linked into the final program image as described by
\secref{Translation steps}.

\specsubitem
The first form of the \nonterminal{use-statement} shall cause the identifiers
declared by the target module to become visible to this \nonterminal{sub-unit}
in their fully-qualified form.

\specsubitem
The second form of the \nonterminal{use-statement} shall cause the identifiers
declared by the target module to become visible to this \nonterminal{sub-unit}
in a rewritten form, with the fully-qualified namespace of the identifiers
being visible under the namespace described by the \nonterminal{name} given in
this form.

\informative{In the use statement \code{use foo = bar::baz;}, identifiers in
the namespace \code{bar::baz} will be visible under the namespace \code{foo}.
For example, if the fully-qualified identifier \code{bar::baz::bat} exists, this
\nonterminal{sub-unit} may refer to it as \code{foo::bat}.}

\specsubitem
The third form of the \nonterminal{use-statement} shall cause only the
identifiers listed in the \nonterminal{name-list}, qualified in the context
of the target namespace, to become visible in their un-qualified form to this
\nonterminal{sub-unit}.

\informative{If the use statement \code{use bar::baz::\{bat\}} were specified
in the same conditions as the previous example, the fully-qualified identifier
\code{bar::baz::bat} may be referred to by its unqualified name \code{bat} in
the scope of this \nonterminal{sub-unit}.}

\specsubitem
The imports of a \nonterminal{sub-unit} are not visible to other
\nonterminal{sub-unit}s in the same translation unit. However, identifiers
\textit{declared} in this \nonterminal{sub-unit} are visible in those
\nonterminal{sub-unit}s.
